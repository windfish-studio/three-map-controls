{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///delegated ./node_modules/three/build/three.module.js from dll-reference vendor","webpack:///./src/three-map-controls.js","webpack:///./test/stub_dom.js","webpack:///external \"vendor\"","webpack:///./src/demo.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","three__WEBPACK_IMPORTED_MODULE_0__","window","require","MapControls","EventDispatcher","constructor","camera","domElement","options","super","this","undefined","document","body","enabled","target","minDistance","maxDistance","enableZoom","zoomSpeed","zoomDampingAlpha","initialZoom","enablePan","keyPanSpeed","keyZoomSpeed","panDampingAlpha","enableKeys","keys","PAN_LEFT","PAN_UP","PAN_RIGHT","PAN_BOTTOM","ZOOM_IN","ZOOM_OUT","mouseButtons","ZOOM","MOUSE","MIDDLE","PAN","LEFT","assign","isTargetValid","mode","Error","normal","constant","center","radius","_eventListeners","contextmenu","_onContextMenu","bind","mousedown","_onMouseDown","mousewheel","_onMouseWheel","MozMousePixelScroll","touchstart","_onTouchStart","touchend","_onTouchEnd","touchmove","_onTouchMove","keydown","_onKeyDown","mouseover","_onMouseOver","mouseout","_onMouseOut","mousemove","_onMouseMove","mouseup","_onMouseUp","_init","target0","clone","position0","position","zoom0","zoom","_changeEvent","type","_startEvent","_endEvent","_STATES","NONE","DOLLY","TOUCH_DOLLY","TOUCH_PAN","distanceToPoint","_state","_mouse","Vector2","_finalTargetDistance","_currentTargetDistance","_panTarget","Vector3","_panCurrent","_minZoomPosition","_maxZoomPosition","_panStart","_panEnd","_panDelta","_dollyStart","_dollyEnd","_dollyDelta","_camOrientation","_zoomAlpha","_screenWorldXform","Math","tan","fov","PI","_straightDollyTrack","lerpVectors","abs","res","_intersectCameraTarget","lookAt","intersection","ray","direction","normalize","_updateZoomAlpha","forEach","_e","addEventListener","tagName","getAttribute","setAttribute","update","coplanar","projectPoint","Ray","subVectors","intersectPlane","intersectSphere","_updateDollyTrack","getZoomAlpha","reset","copy","updateProjectionMatrix","dispatchEvent","panDelta","oldPanCurrent","lerp","add","v","quat","Quaternion","setFromAxisAngle","setFromMatrixColumn","matrix","x","applyQuaternion","y","z","dispose","removeEventListener","zoomToFit","mesh","dims","geometry","boundingSphere","localToWorld","diameter","targetCoord","_sphericalCoordinatesFrom","camCoord","delta","vFOV","hFOV","atan","aspect","obj_aspect","targetAreaVisible","bbox","vOffset","hOffset","depth","distanceToPlane","Box2","cam_pos","halfPi","length","min","cos","_mm","targetAreaVisibleDeg","cartesian_vec","rel_pos","rel_xzcomponent","sphCoord","angleTo","max","diff","damping_alpha","round","intersect","addVectors","multiplyScalar","_calculateMinZoom","sub","_getZoomScale","speed","pow","_panLeft","distance","cameraMatrix","set","_panUp","_pan","deltaX","deltaY","targetDistance","element","camToTarget","clientHeight","_dollyIn","dollyScale","_cameraOfKnownType","console","warn","_dollyOut","_handleUpdateDollyTrackMouse","event","prevMouse","offsetX","clientWidth","offsetY","equals","rc","Raycaster","setFromCamera","_handleMouseDownDolly","_handleMouseDownPan","_handleMouseMoveDolly","_handleMouseMovePan","_handleMouseUp","map_intersect","_handleMouseWheel","wheelDelta","detail","_handleKeyDown","key","_handleUpdateDollyTrackTouch","centerpoint","dx","touches","pageX","dy","pageY","mouse","_handleTouchStartDolly","sqrt","_handleTouchStartPan","_handleTouchMoveDolly","_handleTouchMovePan","_handleTouchEnd","preventDefault","button","stopPropagation","focus","blur","log","vendor","_three_map_controls_js__WEBPACK_IMPORTED_MODULE_1__","SPHERE_RADIUS","demo","container","scene","Scene","renderer","meshes","selectedObjectTween","selectedObject","controls","debugCamViewInterval","camViewMesh","camViewLines","init","setMode","animate","deselect","links","sphere","getElementById","plane","style","display","concat","_m","remove","initSphere","initPlane","PerspectiveCamera","innerWidth","innerHeight","Sphere","colors","SphereBufferGeometry","computeBoundingSphere","vertices","array","color","Color","vert","setRGB","push","g","b","addAttribute","Float32BufferAttribute","Float32Array","from","points","Points","PointsMaterial","size","vertexColors","VertexColors","polys","Mesh","MeshBasicMaterial","transparent","opacity","userData","selectable","lines","wireframe","toggleDebugCamView","e","checked","clearInterval","setInterval","phidelta","PlaneBufferGeometry","side","DoubleSide","Plane","CubeGeometry","material","MeshNormalMaterial","WebGLRenderer","setPixelRatio","devicePixelRatio","setSize","appendChild","onWindowResize","pick","zoomTo","parent","clientX","clientY","raycaster","intersectObjects","children","filter","_int","face","geo","BufferGeometry","orig_vtx_ar","f","new_vtx_ar","a","map","_idx","vtx_ar","flat","setIndex","computeVertexNormals","computeBoundingBox","projected","projectTriangleToPlane","projection_size","verts_ar","centroid","findTriangleCentroid","vecs","_t","fromArray","_v","norm","crossVectors","right","up","prj_vecs","dot","prj_bbox","setFromPoints","prj_dims","getSize","prj_center","prj_delta","projection","projection_bbox","_d","requestAnimationFrame","currentColor","rotation","render"],"mappings":"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","file":"demo.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n","module.exports = (__webpack_require__(3))(0);","'use strict';\n\n//Alex Pilafian 2016-2019 - sikanrong@gmail.com\n\nimport {\n    Box2,\n    Quaternion,\n    EventDispatcher,\n    Vector2,\n    Vector3,\n    Raycaster,\n    Ray,\n    MOUSE\n} from 'three'\n\n//test stubs\nif(typeof window == 'undefined'){\n    let window = require('../test/stub_dom');\n}\n\nclass MapControls extends EventDispatcher{\n\n        constructor(camera, domElement, options){\n            super();\n\n            this.camera = camera;\n\n            //Object to use for listening for keyboard/mouse events\n            this.domElement = ( domElement !== undefined ) ? domElement : window.document.body;\n\n            // Set to false to disable this control (Disables all input events)\n            this.enabled = true;\n\n            // Must be set to instance of Plane or Sphere\n            this.target;\n\n            // How far you can dolly in and out\n            this.minDistance = 1; //probably should never be 0\n            this.maxDistance = 100;\n\n            // This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n            // Set to false to disable zooming\n            this.enableZoom = true;\n            this.zoomSpeed = 6.0;\n            this.zoomDampingAlpha = 0.1;\n            this.initialZoom = 0; //start zoomed all the way out unless set in options.\n\n            // Set to false to disable panning\n            this.enablePan = true;\n            this.keyPanSpeed = 50.0;\t// pixels moved per arrow key push\n            this.keyZoomSpeed = this.zoomSpeed;\t// keyboard zoom speed, defaults to mouse-wheel zoom speed\n            this.panDampingAlpha = 0.1;\n\n            // Set to false to disable use of the keys\n            this.enableKeys = true;\n\n            // The four arrow keys, and two zoom keys\n            this.keys = {\n                PAN_LEFT: \"ArrowLeft\",\n                PAN_UP: \"ArrowUp\",\n                PAN_RIGHT: \"ArrowRight\",\n                PAN_BOTTOM: \"ArrowDown\",\n                ZOOM_IN: \"]\",\n                ZOOM_OUT: \"[\"\n            };\n\n            // Mouse buttons\n            this.mouseButtons = { ZOOM: MOUSE.MIDDLE, PAN: MOUSE.LEFT };\n            \n            //Copy options from parameters\n            Object.assign(this, options);\n            let isTargetValid = false;\n\n            if(this.mode === undefined){\n                throw new Error('\\'mode\\' option must be set to either \\'plane\\' or \\'sphere\\'');\n            }\n\n            switch(this.mode){\n                case 'plane':\n                    isTargetValid = (this.target.normal !== undefined && this.target.constant !== undefined);\n                    break;\n                case 'sphere':\n                    isTargetValid = (this.target.center !== undefined && this.target.radius !== undefined);\n                    break;\n            }\n\n            if(!isTargetValid){\n                throw new Error('\\'target\\' option must be an instance of type THREE.Plane or THREE.Sphere');\n            }\n\n            this._eventListeners = {\n                'contextmenu': this._onContextMenu.bind(this),\n                'mousedown': this._onMouseDown.bind(this),\n                'mousewheel': this._onMouseWheel.bind(this),\n                'MozMousePixelScroll': this._onMouseWheel.bind(this),\n                'touchstart': this._onTouchStart.bind(this),\n                'touchend': this._onTouchEnd.bind(this),\n                'touchmove': this._onTouchMove.bind(this),\n                'keydown': this._onKeyDown.bind(this),\n                'mouseover': this._onMouseOver.bind(this),\n                'mouseout': this._onMouseOut.bind(this),\n                'mousemove': this._onMouseMove.bind(this),\n                'mouseup': this._onMouseUp.bind(this)\n            };\n\n            this._init();\n        }\n\n        _init (){\n\n            this.target0 = this.target.clone();\n            this.position0 = this.camera.position.clone();\n            this.zoom0 = this.camera.zoom;\n            this._changeEvent = { type: 'change' };\n            this._startEvent = { type: 'start' };\n            this._endEvent = { type: 'end' };\n\n            this._STATES = { NONE : - 1, DOLLY : 1, PAN : 2, TOUCH_DOLLY : 4, TOUCH_PAN : 5 };\n\n            if(this.target.distanceToPoint(this.camera.position) == 0){\n                throw new Error(\"ORIENTATION_UNKNOWABLE: initial Camera position cannot intersect target plane.\");\n            }\n\n            this._state = this._STATES.NONE;\n\n            this._mouse = new Vector2();\n\n            this._finalTargetDistance = 0;\n            this._currentTargetDistance = 0;\n\n            this._panTarget = new Vector3(0,0,0);\n            this._panCurrent = new Vector3(0,0,0);\n\n            this._minZoomPosition = new Vector3();\n            this._maxZoomPosition = new Vector3();\n\n            this._panStart = new Vector2();\n            this._panEnd = new Vector2();\n            this._panDelta = new Vector2();\n\n            this._dollyStart = new Vector2();\n            this._dollyEnd = new Vector2();\n            this._dollyDelta = new Vector2();\n\n            this._camOrientation = new Vector2();\n\n            this._zoomAlpha;\n\n            this._screenWorldXform = Math.tan( ( this.camera.fov / 2 ) * Math.PI / 180.0 );\n\n            //establish initial camera orientation based on position w.r.t. _this.target plane\n            this._straightDollyTrack();\n\n            this.camera.position.lerpVectors(this._minZoomPosition, this._maxZoomPosition, this.initialZoom);\n            this._finalTargetDistance = this._currentTargetDistance = Math.abs(this.target.distanceToPoint(this.camera.position));\n\n            const res = this._intersectCameraTarget();\n            this.camera.lookAt(res.intersection); //set the orientation of the camera towards the map.\n            this._camOrientation = res.ray.direction.clone().normalize();\n\n            this._updateZoomAlpha();\n\n            //Assign event listeners\n\n            [\n                'contextmenu',\n                'mousedown',\n                'mousewheel',\n                'MozMousePixelScroll',\n                'touchstart',\n                'touchend',\n                'touchmove',\n                'mouseover',\n                'mouseout',\n                'keydown'\n            ].forEach(_e => {\n                this.domElement.addEventListener(_e, this._eventListeners[_e], false);\n            });\n\n            if(this.domElement.tagName == 'CANVAS' &&\n               !this.domElement.getAttribute('tabindex')){\n                //if we're dealing with a canvas element which has no tabindex,\n                //give it one so that it may recieve keyboard focus\n                this.domElement.setAttribute('tabindex', '1');\n            }\n\n            this.update();\n        }\n\n        _intersectCameraTarget(){\n            let intersection = new Vector3();\n            let ray;\n\n            switch(this.mode){\n                case 'plane':\n                    const coplanar = new Vector3();\n                    this.target.projectPoint(this.camera.position, coplanar);\n                    ray = new Ray(this.camera.position, new Vector3().subVectors(coplanar, this.camera.position).normalize());\n                    ray.intersectPlane(this.target, intersection);\n                    break;\n                case 'sphere':\n                    ray = new Ray(this.camera.position, (new Vector3()).subVectors(this.target.center, this.camera.position).normalize());\n                    ray.intersectSphere(this.target, intersection);\n                    break;\n            }\n\n            return {\n                intersection: intersection,\n                ray: ray\n            }\n        }\n\n        _straightDollyTrack(){\n            this._updateDollyTrack(this._intersectCameraTarget().ray);\n        }\n\n        getZoomAlpha () {\n            return this._zoomAlpha;\n        }\n\n        reset () {\n\n            this.target.copy( this.target0 );\n            this.camera.position.copy( this.position0 );\n            this.camera.zoom = this.zoom0;\n\n            this.camera.updateProjectionMatrix();\n\n            this._init(); //reinit\n\n            this.dispatchEvent( this._changeEvent );\n\n            this.update();\n\n            this._state = this._STATES.NONE;\n\n        };\n\n        // this method is exposed, but perhaps it would be better if we can make it private...\n        update () {\n            const panDelta = new Vector3();\n            const oldPanCurrent = new Vector3();\n            const position = this.camera.position;\n\n            // move target to panned location\n            oldPanCurrent.copy(this._panCurrent);\n            this._panCurrent.lerp( this._panTarget, this.panDampingAlpha );\n            panDelta.subVectors(this._panCurrent, oldPanCurrent);\n\n            switch (this.mode) {\n                case 'plane':\n                    this._maxZoomPosition.add(panDelta);\n                    this._minZoomPosition.add(panDelta);\n                    break;\n                case 'sphere':\n                    const v = new Vector3();\n                    const quat = new Quaternion();\n\n                    quat.setFromAxisAngle(v.setFromMatrixColumn( this.camera.matrix, 1 ), panDelta.x);\n\n                    this._maxZoomPosition.applyQuaternion(quat);\n                    this._minZoomPosition.applyQuaternion(quat);\n\n                    quat.setFromAxisAngle(v.setFromMatrixColumn( this.camera.matrix, 0 ), panDelta.y);\n\n                    this._maxZoomPosition.applyQuaternion(quat);\n                    this._minZoomPosition.applyQuaternion(quat);\n\n                    //panDelta.z is only used for zoomToFit\n                    //all pan operations rotate around the camera's MatrixColumn axes, while zoomToFit needs to\n                    //rotate about the world Y-axis\n                    quat.setFromAxisAngle(new Vector3(0,1,0), panDelta.z);\n                    this._maxZoomPosition.applyQuaternion(quat);\n                    this._minZoomPosition.applyQuaternion(quat);\n\n                    break;\n            }\n\n            position.lerpVectors(this._minZoomPosition, this._maxZoomPosition, this._updateZoomAlpha());\n\n            if(this.mode == 'sphere'){\n                this.camera.lookAt(this.target.center);\n            }\n        }\n\n        dispose () {\n            Object.keys(this._eventListeners).forEach(_e =>{\n                this.domElement.removeEventListener(_e, this._eventListeners[_e], false);\n            });\n        };\n\n        zoomToFit (mesh, center, dims){\n\n            if(center === undefined){\n                center = mesh.geometry.boundingSphere.center.clone();\n            }\n\n            center = mesh.localToWorld(center.clone());\n\n            if(dims === undefined){\n                const diameter = (mesh.geometry.boundingSphere.radius * 2);\n                dims = new Vector2(\n                    diameter,\n                    diameter\n                );\n            }\n\n            switch(this.mode){\n                case 'plane':\n                    this._panTarget.copy(center);\n                    this._panCurrent.copy(this._intersectCameraTarget().intersection);\n                    break;\n                case 'sphere':\n                    const targetCoord = this._sphericalCoordinatesFrom(center);\n                    const camCoord = this._sphericalCoordinatesFrom(this.camera.position);\n                    const delta = new Vector2().subVectors(targetCoord, camCoord);\n\n                    //Handle wrapping around the antimeridian; the line of 2Ï€ (or 0) radians\n                    if(Math.abs(delta.x) > Math.PI){\n                        delta.x = (-Math.abs(delta.x) / delta.x) * ((Math.PI * 2) - Math.abs(delta.x));\n                    }\n\n                    this._panTarget.add(new Vector3(0, -delta.y, delta.x));\n                    break;\n            }\n\n            this._straightDollyTrack();\n\n            const vFOV = this.camera.fov * (Math.PI / 180);\n            const hFOV = 2 * Math.atan( Math.tan( vFOV / 2 ) * this.camera.aspect );\n            const obj_aspect = dims.x / dims.y;\n\n            this._finalTargetDistance = ((((obj_aspect > this.camera.aspect)? dims.x : dims.y) / 2) / Math.tan(((obj_aspect > this.camera.aspect)? hFOV : vFOV) / 2));\n\n\n        };\n\n        //returns a bounding box denoting the visible target area\n        targetAreaVisible(){\n\n            let bbox, vOffset, hOffset, center;\n\n            switch(this.mode){\n                case 'plane':\n                    var ray = new Ray(this.camera.position, this._camOrientation);\n                    var depth = ray.distanceToPlane(this.target);\n\n                    center = this.camera.position.clone();\n\n                    vOffset = this._screenWorldXform * depth;\n                    hOffset = vOffset * this.camera.aspect;\n\n                    bbox = new Box2(\n                        new Vector2(center.x - hOffset, center.y - vOffset),\n                        new Vector2(center.x + hOffset, center.y + vOffset)\n                    );\n\n                    break;\n                case 'sphere':\n                    const cam_pos = (new Vector3()).subVectors(this.target.center, this.camera.position);\n                    center = this._sphericalCoordinatesFrom(this.camera.position);\n\n                    const halfPi = Math.PI / 2;\n\n                    const d = cam_pos.length();\n\n                    //Derived from solving the Haversine formula for Phi_2 when all other variables\n                    //(d, r, Theta_1, Theta_2, Phi_1) are given\n                    vOffset = this._screenWorldXform * ((d / this.target.radius) - 1);\n                    vOffset = Math.min(vOffset, halfPi);\n\n                    //Account for the aspect ratio of the screen, and the deformation of the sphere\n                    const r = this.target.radius * Math.cos(center.y - halfPi);\n                    hOffset = vOffset * this.camera.aspect * ( this.target.radius / r);\n                    hOffset = Math.min(hOffset, halfPi);\n\n                    bbox = new Box2(\n                        new Vector2(center.x - hOffset - halfPi, center.y - vOffset - halfPi),\n                        new Vector2(center.x + hOffset - halfPi, center.y + vOffset - halfPi)\n                    );\n\n                    ['min', 'max'].forEach(_mm => {\n                        bbox[_mm].x = (bbox[_mm].x > Math.PI)? (-2*Math.PI + bbox[_mm].x): bbox[_mm].x;\n                    });\n\n                    break;\n            };\n\n            return bbox;\n        }\n    \n        targetAreaVisibleDeg() {\n            let bbox = this.targetAreaVisible();\n            if(this.mode == 'sphere'){\n                bbox['min'].x = bbox['min'].x * (180/Math.PI);\n                bbox['min'].y = bbox['min'].y * (180/Math.PI);\n                bbox['max'].x = bbox['max'].x * (180/Math.PI);\n                bbox['max'].y = bbox['max'].y * (180/Math.PI);\n            }\n            return bbox;\n        }\n\n        _sphericalCoordinatesFrom (cartesian_vec) {\n            const rel_pos = ((new Vector3()).subVectors(this.target.center, cartesian_vec));\n            const rel_xzcomponent = new Vector3(rel_pos.x, 0, rel_pos.z);\n\n            const v = new Vector3();\n            const sphCoord = new Vector2(\n                rel_xzcomponent.angleTo(new Vector3(1,0,0)),\n                rel_pos.angleTo(new Vector3(0,1,0))\n            );\n            sphCoord.x = (rel_pos.z > 0)? (2*Math.PI - sphCoord.x) : sphCoord.x;\n            return sphCoord;\n        }\n\n        _updateZoomAlpha(){\n            this._finalTargetDistance = Math.max( this.minDistance, Math.min( this.maxDistance, this._finalTargetDistance ) );\n            var diff = this._currentTargetDistance - this._finalTargetDistance;\n            var damping_alpha = this.zoomDampingAlpha;\n            this._currentTargetDistance -= diff * damping_alpha;\n            var rounding_places = 100000;\n            this._zoomAlpha = Math.abs(Math.round((1 - ((this._currentTargetDistance - this.minDistance) / (this.maxDistance - this.minDistance))) * rounding_places ) / rounding_places);\n\n            return this._zoomAlpha;\n        }\n\n        _updateDollyTrack(ray){\n            let intersect = new Vector3();\n\n            switch(this.mode){\n                case 'plane':\n                    ray.intersectPlane(this.target, intersect);\n                    break;\n                case 'sphere':\n                    ray.intersectSphere(this.target, intersect);\n                    break;\n            }\n\n            if(intersect){\n                this._maxZoomPosition.addVectors(intersect, new Vector3().subVectors(this.camera.position, intersect).normalize().multiplyScalar(this.minDistance));\n                this._minZoomPosition.copy(this._calculateMinZoom(this.camera.position, intersect));\n\n                this._finalTargetDistance = this._currentTargetDistance = intersect.clone().sub(this.camera.position).length();\n            }\n        }\n\n        _getZoomScale(speed) {\n            speed = speed || this.zoomSpeed;\n            return Math.pow( 0.95, speed );\n        }\n\n        _panLeft( distance, cameraMatrix ) {\n            var v = new Vector3();\n\n            switch(this.mode){\n                case 'sphere':\n                    v.set(- distance, 0, 0);\n                    break;\n                case 'plane':\n                    v.setFromMatrixColumn( cameraMatrix, 0 ); // get Y column of cameraMatrix\n                    v.multiplyScalar( - distance );\n                    break;\n            }\n\n            this._panTarget.add( v );\n        }\n\n        _panUp ( distance, cameraMatrix ) {\n            var v = new Vector3();\n\n            switch(this.mode){\n                case 'sphere':\n                    v.set(0, - distance, 0);\n                    break;\n                case 'plane':\n                    v.setFromMatrixColumn( cameraMatrix, 1 ); // get Y column of cameraMatrix\n                    v.multiplyScalar( distance );\n                    break;\n            }\n\n            this._panTarget.add( v );\n        }\n\n        // deltaX and deltaY are in pixels; right and down are positive\n        _pan (deltaX, deltaY) {\n            var element = this.domElement;\n\n            var r = new Ray(this.camera.position, this._camOrientation);\n            var targetDistance;\n\n            switch(this.mode){\n                case 'plane':\n                    targetDistance = this._screenWorldXform * r.distanceToPlane(this.target);\n                    break;\n                case 'sphere':\n                    //in spherical mode the pan coords are saved as radians and used as rotation angles\n                    const camToTarget = (new Vector3()).subVectors(this.camera.position, this.target.center);\n                    targetDistance = this._screenWorldXform * ((camToTarget.length() / this.target.radius) - 1);\n                    break;\n            }\n\n            // we actually don't use screenWidth, since perspective camera is fixed to screen height\n            this._panLeft( 2 * deltaX * targetDistance / element.clientHeight, this.camera.matrix );\n            this._panUp( 2 * deltaY * targetDistance / element.clientHeight, this.camera.matrix );\n\n        }\n\n        _dollyIn( dollyScale ) {\n            if ( this._cameraOfKnownType() ) {\n                this._finalTargetDistance /= dollyScale;\n            } else {\n                console.warn( 'WARNING: MapControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n                this.enableZoom = false;\n            }\n        }\n\n        _dollyOut( dollyScale ) {\n            if ( this._cameraOfKnownType() ) {\n                this._finalTargetDistance *= dollyScale;\n            } else {\n                console.warn( 'WARNING: MapControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n                this.enableZoom = false;\n            }\n        }\n\n        _cameraOfKnownType() {\n            return this.camera.type === 'PerspectiveCamera'\n        }\n\n        _handleUpdateDollyTrackMouse(event){\n            var prevMouse = this._mouse.clone();\n            this._mouse.set(( event.offsetX / this.domElement.clientWidth ) * 2 - 1, - ( event.offsetY / this.domElement.clientHeight ) * 2 + 1);\n\n            if(!prevMouse.equals(this._mouse)){\n                var rc = new Raycaster();\n                rc.setFromCamera(this._mouse, this.camera);\n                this._updateDollyTrack(rc.ray);\n            }\n        }\n\n        _handleMouseDownDolly( event ) {\n            this._handleUpdateDollyTrackMouse(event);\n            this._dollyStart.set( event.offsetX, event.offsetY );\n        }\n\n        _handleMouseDownPan( event ) {\n\n            this._panStart.set( event.offsetX, event.offsetY );\n\n        }\n\n        _handleMouseMoveDolly( event ) {\n\n            this._handleUpdateDollyTrackMouse(event);\n\n            //console.log( 'handleMouseMoveDolly' );\n\n            this._dollyEnd.set( event.offsetX, event.offsetY );\n\n            this._dollyDelta.subVectors(this._dollyEnd, this._dollyStart );\n\n            if ( this._dollyDelta.y > 0 ) {\n\n                this._dollyIn( this._getZoomScale() );\n\n            } else if ( this._dollyDelta.y < 0 ) {\n\n                this._dollyOut( this._getZoomScale() );\n\n            }\n\n            this._dollyStart.copy( this._dollyEnd );\n\n            this.update();\n\n        }\n\n        _handleMouseMovePan( event ) {\n\n            //console.log( 'handleMouseMovePan' );\n\n            this._panEnd.set( event.offsetX, event.offsetY );\n\n            this._panDelta.subVectors( this._panEnd, this._panStart );\n\n            this._pan( this._panDelta.x, this._panDelta.y );\n\n            this._panStart.copy( this._panEnd );\n\n            this.update();\n\n        }\n\n        _handleMouseUp( event ) {\n\n            //console.log( 'handleMouseUp' );\n\n        }\n\n        _calculateMinZoom(cam_pos, map_intersect){\n            return map_intersect.clone().add(\n                cam_pos.clone()\n                .sub(map_intersect)\n                .normalize()\n                .multiplyScalar(this.maxDistance)\n            );\n        }\n\n\n        _handleMouseWheel( event ) {\n            this._handleUpdateDollyTrackMouse(event);\n\n            var delta = 0;\n\n            if ( event.wheelDelta !== undefined ) {\n\n                // WebKit / Opera / Explorer 9\n\n                delta = event.wheelDelta;\n\n            } else if ( event.detail !== undefined ) {\n\n                // Firefox\n\n                delta = - event.detail;\n\n            }\n\n            if ( delta > 0 ) {\n                this._dollyOut( this._getZoomScale() );\n            } else if ( delta < 0 ) {\n                this._dollyIn( this._getZoomScale() );\n            }\n\n            this.update();\n        }\n\n        _handleKeyDown( event ) {\n\n            //console.log( 'handleKeyDown' );\n\n            switch ( event.key ) {\n\n                case this.keys.PAN_UP:\n                    this._pan( 0, this.keyPanSpeed );\n                    this.update();\n                    break;\n\n                case this.keys.PAN_BOTTOM:\n                    this._pan( 0, - this.keyPanSpeed );\n                    this.update();\n                    break;\n\n                case this.keys.PAN_LEFT:\n                    this._pan( this.keyPanSpeed, 0 );\n                    this.update();\n                    break;\n\n                case this.keys.PAN_RIGHT:\n                    this._pan( - this.keyPanSpeed, 0 );\n                    this.update();\n                    break;\n\n                case this.keys.ZOOM_IN:\n                    this._dollyIn( this._getZoomScale(this.keyZoomSpeed) )\n                    this.update();\n                    break;\n\n                case this.keys.ZOOM_OUT:\n                    this._dollyOut( this._getZoomScale(this.keyZoomSpeed) )\n                    this.update();\n                    break;\n\n            }\n        }\n\n        _handleUpdateDollyTrackTouch( event ){\n            var centerpoint = new Vector2();\n\n            var dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n            var dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n            centerpoint.x = event.touches[ 0 ].pageX + (dx / 2);\n            centerpoint.y = event.touches[ 0 ].pageY + (dy / 2);\n\n            var mouse = new Vector2();\n            mouse.x = ( centerpoint.x / domElement.clientWidth ) * 2 - 1;\n            mouse.y = - ( centerpoint.y / domElement.clientHeight ) * 2 + 1;\n\n            this._updateDollyTrack(mouse);\n        }\n\n        _handleTouchStartDolly( event ) {\n            this._handleUpdateDollyTrackTouch(event);\n\n            var dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n            var dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n            var distance = Math.sqrt( dx * dx + dy * dy );\n\n            this._dollyStart.set( 0, distance );\n\n        }\n\n        _handleTouchStartPan( event ) {\n\n            //console.log( 'handleTouchStartPan' );\n\n            this._panStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n        }\n\n\n        _handleTouchMoveDolly( event ) {\n            this._handleUpdateDollyTrackTouch(event);\n\n            //console.log( 'handleTouchMoveDolly' );\n\n            var dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\n            var dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\n\n            var distance = Math.sqrt( dx * dx + dy * dy );\n\n            this._dollyEnd.set( 0, distance );\n\n            this._dollyDelta.subVectors( this._dollyEnd, this._dollyStart );\n\n            if ( this._dollyDelta.y > 0 ) {\n\n                this._dollyOut( this._getZoomScale() );\n\n            } else if ( this._dollyDelta.y < 0 ) {\n\n                this._dollyIn( this._getZoomScale() );\n\n            }\n\n            this._dollyStart.copy( this._dollyEnd );\n\n            this.update();\n\n        }\n\n        _handleTouchMovePan( event ) {\n\n            this._panEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\n\n            this._panDelta.subVectors( this._panEnd, this._panStart );\n\n            this._pan( this._panDelta.x, this._panDelta.y );\n\n            this._panStart.copy( this._panEnd );\n\n            this.update();\n\n        }\n\n        _handleTouchEnd( event ) {\n            //console.log( 'handleTouchEnd' );\n        }\n\n        //\n        // event handlers - FSM: listen for events and reset state\n        //\n\n        _onMouseDown( event ) {\n\n            if ( this.enabled === false ) return;\n\n            event.preventDefault();\n\n            if ( event.button === this.mouseButtons.ZOOM ) {\n\n                if ( this.enableZoom === false ) return;\n\n                this._handleMouseDownDolly( event );\n\n                this._state = this._STATES.DOLLY;\n\n            } else if ( event.button === this.mouseButtons.PAN ) {\n\n                if ( this.enablePan === false ) return;\n\n                this._handleMouseDownPan( event );\n\n                this._state = this._STATES.PAN;\n\n            }\n\n            if ( this._state !== this._STATES.NONE ) {\n\n                this.domElement.addEventListener( 'mousemove', this._eventListeners.mousemove, false );\n                this.domElement.addEventListener( 'mouseup', this._eventListeners.mouseup, false );\n\n                this.dispatchEvent( this._startEvent );\n\n            }\n\n        }\n\n        _onMouseMove( event ) {\n\n            if ( this.enabled === false ) return;\n\n            event.preventDefault();\n\n            if ( this._state === this._STATES.DOLLY ) {\n\n                if ( this.enableZoom === false ) return;\n\n                this._handleMouseMoveDolly( event );\n\n            } else if ( this._state === this._STATES.PAN ) {\n\n                if ( this.enablePan === false ) return;\n\n                this._handleMouseMovePan( event );\n            }\n        }\n\n        _onMouseUp( event ) {\n\n            if ( this.enabled === false ) return;\n\n            this._handleMouseUp( event );\n\n            this.domElement.removeEventListener( 'mousemove', this._eventListeners.mousemove, false );\n            this.domElement.removeEventListener( 'mouseup', this._eventListeners.mouseup, false );\n\n            this.dispatchEvent( this._endEvent );\n\n            this._state = this._STATES.NONE;\n\n        }\n\n        _onMouseWheel( event ) {\n            if ( this.enabled === false || this.enableZoom === false || ( this._state !== this._STATES.NONE ) ) return;\n\n            event.preventDefault();\n            event.stopPropagation();\n\n            this._handleMouseWheel( event );\n\n            this.dispatchEvent( this._startEvent ); // not sure why these are here...\n            this.dispatchEvent( this._endEvent );\n\n        }\n\n        _onKeyDown( event ) {\n            if ( this.enabled === false || this.enableKeys === false || this.enablePan === false ) return;\n\n            this._handleKeyDown( event );\n        }\n\n        _onTouchStart( event ) {\n\n            if ( this.enabled === false ) return;\n\n            switch ( event.touches.length ) {\n                case 1: // three-fingered touch: pan\n\n                    if ( this.enablePan === false ) return;\n\n                    this._handleTouchStartPan( event );\n\n                    this._state = this._STATES.TOUCH_PAN;\n\n                    break;\n\n                case 2:\t// two-fingered touch: dolly\n\n                    if ( this.enableZoom === false ) return;\n\n                    this._handleTouchStartDolly( event );\n\n                    this._state = this._STATES.TOUCH_DOLLY;\n\n                    break;\n\n                default:\n\n                    this._state = this._STATES.NONE;\n\n            }\n\n            if ( this._state !== this._STATES.NONE ) {\n\n                this.dispatchEvent( this._startEvent );\n\n            }\n\n        }\n\n        _onTouchMove( event ) {\n\n            if ( this.enabled === false ) return;\n\n            event.preventDefault();\n            event.stopPropagation();\n\n            switch ( event.touches.length ) {\n\n                case 1: // one-fingered touch: pan\n                    if ( this.enablePan === false ) return;\n                    if ( this._state !== this._STATES.TOUCH_PAN ) return; // is this needed?...\n\n                    this._handleTouchMovePan( event );\n\n                    break;\n\n                case 2: // two-fingered touch: dolly\n\n                    if ( this.enableZoom === false ) return;\n                    if ( this._state !== this._STATES.TOUCH_DOLLY ) return; // is this needed?...\n\n                    this._handleTouchMoveDolly( event );\n\n                    break;\n\n                default:\n\n                    this._state = this._STATES.NONE;\n\n            }\n\n        }\n\n        _onTouchEnd( event ) {\n\n            if ( this.enabled === false ) return;\n\n            this._handleTouchEnd( event );\n\n            this.dispatchEvent( this._endEvent );\n\n            this._state = this._STATES.NONE;\n\n        }\n\n        _onContextMenu( event ) {\n            event.preventDefault();\n        }\n\n        _onMouseOver ( event ) {\n            this.domElement.focus();\n            return false;\n        }\n\n        _onMouseOut ( event ) {\n            this.domElement.blur();\n            return false;\n        }\n\n};\n\nexport default MapControls;\n","module.exports = {\n    console: {\n        log: function () {}\n    },\n    document: {\n        body: {\n            clientWidth: 1920,\n            clientHeight: 1080,\n            addEventListener: function () {},\n            removeEventListener: function () {}\n        }\n    }\n};\n","module.exports = vendor;","import {\n    Scene,\n    Vector3,\n    Vector2,\n    Quaternion,\n    Box2,\n    Box3,\n    PerspectiveCamera,\n    SphereBufferGeometry,\n    PlaneBufferGeometry,\n    BufferGeometry,\n    CubeGeometry,\n    PointsMaterial,\n    MeshBasicMaterial,\n    MeshNormalMaterial,\n    Color,\n    DoubleSide,\n    VertexColors,\n    Mesh,\n    Points,\n    Raycaster,\n    Float32BufferAttribute,\n    Plane,\n    Sphere,\n    WebGLRenderer\n} from 'three';\nimport MapControls from './three-map-controls.js';\n\nconst SPHERE_RADIUS = 10;\n\nclass MapControlsDemo {\n    constructor (mode) {\n        this.container = document.body;\n        this.scene = new Scene();\n        this.renderer = null;\n        this.meshes = [];\n        this.dims = 10;\n        this.selectedObjectTween = 0;\n        this.selectedObject = null;\n        this.controls;\n        this.mode;\n\n        this.debugCamViewInterval;\n\n        this.camViewMesh;\n        this.camViewLines;\n\n        this.init();\n        this.setMode(mode);\n        this.animate();\n    }\n\n    setMode(mode) {\n        this.deselect();\n        this.mode = mode;\n        const links = {\n            sphere: document.getElementById('sphere-link'),\n            plane: document.getElementById('plane-link')\n        };\n\n        links[this.mode].style.display = 'none';\n        links[(this.mode == 'plane')? 'sphere' : 'plane'].style.display = 'inline-block';\n\n        this.meshes.concat([this.camViewLines, this.camViewMesh]).forEach((_m) => {\n            if(_m === undefined){\n                return;\n            }\n\n            this.scene.remove(_m);\n            _m.geometry.dispose();\n        });\n\n        this.camViewLines = this.camViewMesh = undefined;\n\n        switch(this.mode){\n            case 'sphere':\n                this.initSphere();\n                break;\n            case 'plane':\n                this.initPlane();\n                break;\n        }\n    }\n\n    initSphere(){\n\n        var camera = new PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 1000 );\n        camera.position.z = 40;\n        this.controls = new MapControls( camera, this.renderer.domElement, {\n            target: new Sphere(new Vector3(0,0,0), SPHERE_RADIUS),\n            mode: 'sphere',\n            minDistance: 1,\n            maxDistance: camera.position.z\n        });\n\n        const colors = [];\n\n        const geometry = new SphereBufferGeometry(SPHERE_RADIUS, this.dims, this.dims);\n        geometry.computeBoundingSphere();\n\n        const vertices = geometry.getAttribute('position').array;\n        for(var i = 0; i < vertices.length; i += 3){\n            var color = new Color();\n            var vert = new Vector3(vertices[i], vertices[i+1], vertices[i+2]);\n\n            color.setRGB(\n                ( vert.x / SPHERE_RADIUS ) + 0.5,\n                ( vert.y / SPHERE_RADIUS ) + 0.5,\n                ( vert.z / SPHERE_RADIUS ) + 0.5\n            );\n\n            colors.push( color.r, color.g, color.b );\n        }\n\n        geometry.addAttribute( 'color', new Float32BufferAttribute( Float32Array.from(colors), 3 ) );\n\n        const points = new Points(\n            geometry,\n            new PointsMaterial( { size: 1, vertexColors: VertexColors } )\n        );\n\n        this.scene.add( points );\n        this.meshes.push( points );\n\n        const polys = new Mesh(\n            geometry,\n            new MeshBasicMaterial({\n                vertexColors: VertexColors,\n                transparent: true,\n                opacity: 0.2\n\n            })\n        );\n\n        polys.userData.selectable = true;\n\n        this.meshes.push( polys );\n        this.scene.add( polys );\n\n        const lines = new Mesh(\n            geometry,\n            new MeshBasicMaterial({\n                vertexColors: VertexColors,\n                wireframe: true\n            })\n        );\n\n        this.meshes.push( lines );\n        this.scene.add( lines );\n\n    }\n\n    toggleDebugCamView(e){\n        if(!e.target.checked){\n            clearInterval(this.debugCamViewInterval);\n            this.scene.remove( this.camViewMesh );\n            this.scene.remove( this.camViewLines );\n            this.camViewMesh.geometry.dispose();\n            this.camViewLines.geometry.dispose();\n            this.camViewLines = this.camViewMesh = undefined;\n            return true;\n        }\n\n        this.debugCamViewInterval = setInterval(() => {\n            const bbox = this.controls.targetAreaVisible();\n            console.log(`${bbox.min.x}, ${bbox.min.y}, ${bbox.max.x}, ${bbox.max.y}`);\n\n            let geometry, position;\n            position = new Vector3(0,0,0);\n\n            switch (this.mode) {\n                case 'sphere':\n                    let phidelta = Math.abs(bbox.max.x - bbox.min.x);\n                    if(phidelta > Math.PI){\n                        phidelta = Math.abs((bbox.max.x + Math.PI*2) - bbox.min.x);\n                    }\n                    geometry = new SphereBufferGeometry(SPHERE_RADIUS, this.dims, this.dims,\n                        bbox.min.x + Math.PI/2, //phistart\n                        phidelta, //philength\n                        -bbox.max.y + Math.PI/2, //thetastart\n                        Math.abs(bbox.max.y - bbox.min.y) //thetalength\n                    );\n                    break;\n                case 'plane':\n\n                    geometry = new PlaneBufferGeometry(\n                        (bbox.max.x - bbox.min.x),\n                        (bbox.max.y - bbox.min.y),\n                        this.dims, this.dims\n                    );\n\n                    position.copy(this.controls.camera.position);\n                    position.z = 0;\n\n                    break;\n            }\n\n            if(this.camViewMesh == undefined){\n                this.camViewMesh = new Mesh(\n                    geometry,\n                    new MeshBasicMaterial({\n                        color: new Color(1, 0, 0),\n                        side: DoubleSide,\n                        transparent: true,\n                        opacity: 0.5\n                    })\n                );\n\n                this.camViewLines = new Mesh(\n                    geometry,\n                    new MeshBasicMaterial({\n                        color: new Color(1, 0, 0),\n                        wireframe: true\n                    })\n                );\n\n                this.scene.add( this.camViewMesh );\n                this.scene.add( this.camViewLines );\n            }else{\n\n                this.camViewMesh.geometry.copy(geometry);\n                this.camViewLines.geometry.copy(geometry);\n\n                geometry.dispose();\n            }\n\n            this.camViewMesh.geometry.computeBoundingSphere();\n            this.camViewMesh.position.copy(position);\n            this.camViewLines.position.copy(position);\n\n        }, 1000);\n    }\n\n    initPlane(){\n\n        var camera = new PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000 );\n        camera.position.z = 20;\n        this.controls = new MapControls( camera, this.renderer.domElement, {\n            target: new Plane(new Vector3(0,0,1), 0),\n            mode: 'plane',\n            minDistance: 2.0,\n            maxDistance: 20\n        });\n\n        var offset = 3;\n\n        for(var x = 0; x < this.dims; x++){\n            for(var y = 0; y < this.dims; y++){\n                var geometry = new CubeGeometry(1, 1, 1);\n                var material = new MeshNormalMaterial();\n\n                var mesh = new Mesh( geometry, material );\n                mesh.position.x += ((-0.5 * this.dims * offset) + (x * offset));\n                mesh.position.y += ((-0.5 * this.dims * offset) + (y * offset));\n                mesh.userData.selectable = true;\n                this.meshes.push( mesh );\n                this.scene.add( mesh );\n\n                mesh.geometry.computeBoundingSphere();\n            }\n        }\n    }\n\n    init () {\n        this.renderer = new WebGLRenderer();\n        this.renderer.setPixelRatio( window.devicePixelRatio );\n        this.renderer.setSize( window.innerWidth, window.innerHeight );\n\n        this.container.appendChild( this.renderer.domElement );\n\n        window.addEventListener( 'resize', ()=>{\n            this.onWindowResize();\n        }, false );\n\n        this.renderer.domElement.addEventListener( 'mousedown', (_e) => {this.pick(_e)} );\n        this.renderer.domElement.addEventListener( 'dblclick', (_e) => {this.zoomTo(_e)} );\n\n        const cb = document.getElementById('toggleCamDebug');\n        cb.addEventListener('click', this.toggleDebugCamView.bind(this));\n    }\n\n    zoomTo(){\n        if(!this.selectedObject)\n            return;\n\n        switch(this.mode){\n            case 'sphere':\n                this.controls.zoomToFit(\n                    this.selectedObject,\n                    this.selectedObject.userData.zoom.center,\n                    this.selectedObject.userData.zoom.dims\n                );\n                break;\n            case 'plane':\n                this.controls.zoomToFit( this.selectedObject );\n                break;\n        }\n    }\n\n    deselect() {\n        if(this.selectedObject){\n            switch (this.mode) {\n                case 'sphere':\n                    this.selectedObject.parent.remove(this.selectedObject);\n                    this.selectedObject.geometry.dispose();\n                    this.selectedObject.material.dispose();\n                    break;\n                case 'plane':\n                    this.selectedObject.material.dispose();\n                    this.selectedObject.material = new MeshNormalMaterial();\n                    break;\n            }\n        }\n\n        this.selectedObject = null;\n    }\n\n    pick(event){\n        this.deselect();\n\n        const mouse = new Vector2();\n\n        mouse.x = ( event.clientX / this.renderer.domElement.clientWidth ) * 2 - 1;\n        mouse.y = - ( event.clientY / this.renderer.domElement.clientHeight ) * 2 + 1;\n\n        const raycaster = new Raycaster();\n\n        raycaster.setFromCamera(mouse, this.controls.camera);\n\n        // calculate objects intersecting the picking ray\n        const intersect = (raycaster.intersectObjects( this.scene.children, true )).filter(_int => {\n            return _int.object.userData.selectable;\n        })[0];\n\n        if(intersect !== undefined && intersect.face){\n            switch (this.mode) {\n                case 'sphere':\n                    //create a new selectedObject from the triangle that was raycasted.\n                    const geo = new BufferGeometry();\n                    const orig_geo = intersect.object.geometry;\n                    const orig_vtx_ar = orig_geo.getAttribute('position').array;\n                    const f = intersect.face;\n                    const new_vtx_ar = [f.a, f.b, f.c].map(_idx => {\n                        const vtx_ar = [];\n                        for(let i = 0; i < 3; i++){\n                            vtx_ar.push(orig_vtx_ar[(_idx * 3) + i]);\n                        }\n                        return vtx_ar;\n                    }).flat();\n\n                    geo.setIndex([0,1,2]);\n                    geo.addAttribute('position', new Float32BufferAttribute(Float32Array.from(new_vtx_ar), 3));\n\n                    geo.computeBoundingSphere();\n                    geo.computeVertexNormals();\n                    geo.computeBoundingBox();\n\n                    this.selectedObject = new Mesh(geo, new MeshBasicMaterial({\n                        color: new Color(1,0,0),\n                        transparent: true,\n                        opacity: 0.5\n                    }));\n\n                    const projected = this.projectTriangleToPlane(new_vtx_ar);\n\n                    Object.assign(this.selectedObject.userData, {\n                        zoom: {\n                            center: projected.center,\n                            dims: projected.projection_size\n                        }\n                    });\n\n                    this.scene.add(this.selectedObject);\n                    break;\n                case 'plane':\n                    this.selectedObject = intersect.object;\n                    this.selectedObject.material.dispose();\n                    this.selectedObject.material = new MeshBasicMaterial({\n                        color: new Color(1,0,0),\n                        wireframe: true\n                    });\n                    break;\n            }\n\n        }else{\n            this.deselect();\n        }\n\n    }\n\n    projectTriangleToPlane(verts_ar){\n        const centroid = this.findTriangleCentroid(verts_ar);\n\n        const vecs = [0,1,2].map(_t => {\n            return new Vector3().fromArray([0,1,2].map(_v => {\n                return verts_ar[(_t*3)+_v];\n            })).sub(centroid);\n        });\n\n        const norm = new Vector3().crossVectors(vecs[1], vecs[0]).normalize();\n        const right = new Vector3().crossVectors(new Vector3(0,1,0), norm).normalize();\n        const up = new Vector3().crossVectors(norm, right).normalize();\n        const prj_vecs = vecs.map(_v => {\n            return new Vector2(\n                _v.dot(right),\n                _v.dot(up)\n            );\n        });\n\n        const prj_bbox = new Box2().setFromPoints(prj_vecs);\n        const prj_dims = new Vector2();\n        prj_bbox.getSize(prj_dims);\n\n        const prj_center = new Vector2(\n            prj_bbox.min.x + (prj_dims.x / 2),\n            prj_bbox.min.y + (prj_dims.y / 2)\n        );\n\n        const prj_delta = new Vector2().subVectors(prj_center,  prj_vecs[0]);\n\n        //translate the 3d centroid to the position of the 2d projected center via prj_delta, up, and right.\n        const center = vecs[0].clone().add(centroid);\n        center.add(up.clone().multiplyScalar(prj_delta.y));\n        center.add(right.clone().multiplyScalar(prj_delta.x));\n\n        return {\n            center: center,\n            projection: prj_vecs,\n            projection_bbox: prj_bbox,\n            projection_size: prj_dims\n        };\n\n    }\n\n    findTriangleCentroid (verts_ar) {\n        let center = [0,0,0];\n\n        [0,1,2].forEach(_v => {\n            [0,1,2].forEach(_d => {\n                center[_d] += verts_ar[(_v*3) + _d];\n            });\n        });\n\n        center = center.map(_d => {return _d / 3;});\n\n        return (new Vector3()).fromArray(center);\n    }\n\n    onWindowResize(){\n        this.renderer.setSize( window.innerWidth, window.innerHeight );\n        this.controls.camera.aspect = this.renderer.domElement.clientWidth / this.renderer.domElement.clientHeight;\n        this.controls.camera.updateProjectionMatrix();\n        this.renderer.setSize( this.renderer.domElement.clientWidth, this.renderer.domElement.clientHeight );\n    }\n\n    animate(){\n        requestAnimationFrame( () => {\n            this.animate();\n        } );\n\n        if(this.selectedObject){\n            const currentColor = this.selectedObject.material.color;\n            this.selectedObjectTween += 0.025;\n            currentColor.g = Math.abs(1 - (this.selectedObjectTween % 2));\n        }\n\n        if(this.mode == 'plane'){\n            this.meshes.forEach(( mesh ) => {\n                mesh.rotation.x += 0.005;\n                mesh.rotation.y += 0.01;\n            });\n        }\n\n        this.controls.update();\n        this.renderer.render( this.scene, this.controls.camera );\n    }\n};\n\nwindow.addEventListener('load', () => {\n    window.demo = new MapControlsDemo('sphere');\n});"],"sourceRoot":""}